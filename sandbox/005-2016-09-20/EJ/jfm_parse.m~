
mfile_path=fileparts(mfilename('fullpath'))

raw_path = '/disk1/prvdata/EJ/'

jar_file = strcat(raw_path, 'Vision/Vision.jar')
javaaddpath(jar_file)

add_path = '2005-04-26-0/data002/'
full_path = strcat(raw_path, add_path)
rawFile = edu.ucsc.neurobiology.vision.io.RawDataFile(full_path)

% rawFile = edu.ucsc.neurobiology.vision.io.RawDataFile( \
%   '/usr/local/google/home/bhaishahster/Downloads/data002/');

% One can check dataset details (duration, number of electrodes, etc):
% the following :
% rawFile.getHeader()
% the geometry of the electrodes is in 'Electrode positions' folder.

% gets data from sample 0 to 20000 (first second) across all electrodes
time_len  = 30; % in seconds
samplingRate = 20000;
channels=1:7;

raw=zeros(length(channels),samplingRate*time_len);
for s=1:time_len
    disp(s);
    data_len = samplingRate * 1; % 1 = one second
    data = rawFile.getData(data_len*(s-1)+1, data_len); % start time, length of datasets
    disp(size(data));
    raw(:,data_len*(s-1)+1:data_len*s)=data(:,channels)';
end

rawFile.close();

mkdir raw

writemda(raw,'raw.mda','uint16');

% Stimulus TTLs (most times every 100 frames) on java electrode
% position 0 (1 in matlab) other electrodes are raw voltage traces
%figure;
%plot(data(:,1:3));


